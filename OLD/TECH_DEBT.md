# Технический долг

Этот файл документирует архитектурные компромиссы и "плохие" паттерны, которые мы сознательно используем в проекте.

## Причина существования этого файла

Мы выбираем простоту и скорость разработки вместо "идеальной" архитектуры. Это осознанный выбор для быстрой итерации и личного проекта.

---

## 1. Использование `window.*` для модулей в content scripts

**Что делаем:**
```javascript
// modules/state.js
window.stolotoState = { ... };

// modules/search.js
window.stolotoSearch = { ... };

// content.js
const state = window.stolotoState;
```

**Почему это "плохо":**
- Загрязнение глобального пространства имен
- Нет явных зависимостей между модулями
- Порядок загрузки файлов критичен
- Может конфликтовать с кодом страницы

**Почему мы это делаем:**
- Chrome не поддерживает ES modules в content scripts через manifest
- Не хотим добавлять бандлер (Vite/Rollup/Webpack)
- Работает прямо сейчас без шага сборки
- Легко дебажить - видим исходные файлы
- Быстрая разработка - F5 и всё работает

**Когда исправим:**
- Если проект вырастет >20 файлов
- Если понадобятся npm пакеты
- Если будем публиковать в Chrome Web Store

---

## 2. Использование fallback для chrome.storage.session

**Что делаем:**
```javascript
if ('session' in chrome.storage) {
  await chrome.storage.session.set({ ... });
} else {
  await chrome.storage.local.set({ ... });
}
```

**Почему это "плохо":**
- Дублирование кода
- Нужно помнить про fallback везде

**Почему мы это делаем:**
- `chrome.storage.session` появился только в Chrome 102
- Хотим поддержку старых версий
- Это временно - можем убрать через год-два

**Когда исправим:**
- Когда Chrome 102+ станет минимальной версией (>95% пользователей)

---

## 3. [Будущие пункты добавятся здесь]

---

## Правило

Каждый раз, когда мы делаем что-то "не по best practices", добавляем это сюда с объяснением **почему**.
