# –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å–∞–π—Ç–∞ –°—Ç–æ–ª–æ—Ç–æ

## –û–±–∑–æ—Ä

–î–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Å–∏—Å—Ç–µ–º—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –Ω–∞ —Å–∞–π—Ç–µ –°—Ç–æ–ª–æ—Ç–æ, –º–µ—Ç–æ–¥—ã –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –ø–æ–ª—É—á–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ –∏ —Ä–∞–±–æ—Ç—ã —Å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞ –∞–Ω–∞–ª–∏–∑–µ –∫–æ–¥–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è.

## –°–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –ù–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

#### –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

1. **–°—Å—ã–ª–∫–∞ "–í—Ö–æ–¥ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è"**
   ```html
   <link href="/auth?targetUrl=%2Fruslotto%2Fgame%3FviewType%3Dfavorite">
     –í—Ö–æ–¥ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
   </link>
   ```
   
   **–°–µ–ª–µ–∫—Ç–æ—Ä**: `a[href*="/auth"]`
   **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—Å—Ç–∞**: —Å–æ–¥–µ—Ä–∂–∏—Ç "–í—Ö–æ–¥ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è"

2. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**
   - –ù–µ—Ç —Å—Å—ã–ª–∫–∏ –Ω–∞ –∫–æ—à–µ–ª–µ–∫
   - –ù–µ—Ç —Å—Å—ã–ª–∫–∏ –Ω–∞ –±–æ–Ω—É—Å—ã
   - –ù–µ—Ç —Å—Å—ã–ª–∫–∏ "–ú–æ–∏ –±–∏–ª–µ—Ç—ã"

#### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–ª—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

- –¢–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä –±–∏–ª–µ—Ç–æ–≤ –±–µ–∑ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–æ–∫—É–ø–∫–∏
- –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –±–∞–ª–∞–Ω—Å—É –∏ –±–æ–Ω—É—Å–∞–º
- –ù–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ–∫—É–ø–æ–∫
- –†–µ–∂–∏–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø–æ–∫—É–ø–∫–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

### –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

#### –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

1. **–°—Å—ã–ª–∫–∞ –Ω–∞ –±–∞–ª–∞–Ω—Å (–∫–æ—à–µ–ª–µ–∫)**
   ```html
   <a href="/private/wallet?int=header">1 500 ‚ÇΩ</a>
   ```
   
   **–°–µ–ª–µ–∫—Ç–æ—Ä**: `a[href="/private/wallet?int=header"]`
   **–§–æ—Ä–º–∞—Ç —Ç–µ–∫—Å—Ç–∞**: "X ‚ÇΩ" (–Ω–∞–ø—Ä–∏–º–µ—Ä, "0 ‚ÇΩ", "1 500 ‚ÇΩ")

2. **–°—Å—ã–ª–∫–∞ –Ω–∞ –±–æ–Ω—É—Å—ã**
   ```html
   <a href="/private/bonus?int=header">46</a>
   ```
   
   **–°–µ–ª–µ–∫—Ç–æ—Ä**: `a[href="/private/bonus?int=header"]`
   **–§–æ—Ä–º–∞—Ç —Ç–µ–∫—Å—Ç–∞**: —á–∏—Å–ª–æ (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–æ–Ω—É—Å–æ–≤)

3. **–°—Å—ã–ª–∫–∞ "–ú–æ–∏ –±–∏–ª–µ—Ç—ã"**
   ```html
   <a href="/private/tickets/all?int=header">–ú–æ–∏ –±–∏–ª–µ—Ç—ã</a>
   ```
   
   **–°–µ–ª–µ–∫—Ç–æ—Ä**: `a[href="/private/tickets/all?int=header"]`

## –§—É–Ω–∫—Ü–∏–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

### –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏: `isUserLoggedIn()`

```javascript
function isUserLoggedIn() {
    // 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Å—Å—ã–ª–∫–∏ "–í—Ö–æ–¥ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è"
    const loginLink = document.querySelector('a[href*="/auth"]');
    if (loginLink && loginLink.textContent.includes('–í—Ö–æ–¥ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è')) {
        console.log('–û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ —Å—Å—ã–ª–∫–∞ "–í—Ö–æ–¥ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è" - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ù–ï –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω');
        return false;
    }
    
    // 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –∫–æ—à–µ–ª–µ–∫
    const walletLink = document.querySelector('a[href="/private/wallet?int=header"]');
    if (walletLink) {
        console.log('–û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ —Å—Å—ã–ª–∫–∞ –Ω–∞ –∫–æ—à–µ–ª–µ–∫ - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω');
        return true;
    }
    
    // 3. –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Å—Å—ã–ª–∫–∏ "–ú–æ–∏ –±–∏–ª–µ—Ç—ã"
    const myTicketsLink = document.querySelector('a[href="/private/tickets/all?int=header"]');
    if (myTicketsLink) {
        console.log('–û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ —Å—Å—ã–ª–∫–∞ "–ú–æ–∏ –±–∏–ª–µ—Ç—ã" - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω');
        return true;
    }
    
    // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å—á–∏—Ç–∞–µ–º –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º
    return false;
}
```

#### –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

1. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è**
   - –°–Ω–∞—á–∞–ª–∞ –∏—â–µ–º —Å—Å—ã–ª–∫—É "–í—Ö–æ–¥ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è"
   - –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–∞ - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ç–æ—á–Ω–æ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏**
   - –°—Å—ã–ª–∫–∞ –Ω–∞ –∫–æ—à–µ–ª–µ–∫ - –æ—Å–Ω–æ–≤–Ω–æ–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
   - –°—Å—ã–ª–∫–∞ "–ú–æ–∏ –±–∏–ª–µ—Ç—ã" - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä

3. **Fallback –ø–æ–≤–µ–¥–µ–Ω–∏–µ**
   - –ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –≤—Å–µ—Ö –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ —Å—á–∏—Ç–∞–µ–º –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º

## –†–∞–±–æ—Ç–∞ —Å –±–∞–ª–∞–Ω—Å–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞: `getUserBalance()`

```javascript
function getUserBalance() {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
    if (!isUserLoggedIn()) {
        console.log('–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω');
        return 0;
    }
    
    // –ò—â–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ –∫–æ—à–µ–ª–µ–∫
    const walletLink = document.querySelector('a[href="/private/wallet?int=header"]');
    if (walletLink) {
        const balanceText = walletLink.textContent.trim();
        console.log('–ù–∞–π–¥–µ–Ω —Ç–µ–∫—Å—Ç –±–∞–ª–∞–Ω—Å–∞:', balanceText);
        
        // –ò–∑–≤–ª–µ–∫–∞–µ–º —á–∏—Å–ª–æ –∏–∑ —Ç–µ–∫—Å—Ç–∞ "1 500 ‚ÇΩ"
        const matches = balanceText.match(/(\d+(?:\s\d+)*)\s*‚ÇΩ/);
        if (matches) {
            const balanceValue = parseInt(matches[1].replace(/\s/g, ''));
            console.log('–ë–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', balanceValue);
            return balanceValue;
        }
    }
    
    return 0;
}
```

#### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞

1. **–§–æ—Ä–º–∞—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞**
   ```
   –ü—Ä–∏–º–µ—Ä—ã:
   - "0 ‚ÇΩ"
   - "150 ‚ÇΩ"
   - "1 500 ‚ÇΩ"
   - "10 000 ‚ÇΩ"
   ```

2. **–†–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è**
   ```javascript
   const regex = /(\d+(?:\s\d+)*)\s*‚ÇΩ/;
   // –û–±—ä—è—Å–Ω–µ–Ω–∏–µ:
   // (\d+(?:\s\d+)*) - –æ–¥–Ω–∞ –∏–ª–∏ –±–æ–ª–µ–µ —Ü–∏—Ñ—Ä, –∑–∞ –∫–æ—Ç–æ—Ä—ã–º–∏ –º–æ–≥—É—Ç —Å–ª–µ–¥–æ–≤–∞—Ç—å –ø—Ä–æ–±–µ–ª—ã –∏ –µ—â–µ —Ü–∏—Ñ—Ä—ã
   // \s*‚ÇΩ - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–µ–ª—ã –∏ —Å–∏–º–≤–æ–ª —Ä—É–±–ª—è
   ```

3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–±–µ–ª–æ–≤ –≤ —á–∏—Å–ª–∞—Ö**
   ```javascript
   const cleanNumber = matches[1].replace(/\s/g, '');
   const balance = parseInt(cleanNumber);
   ```

### –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ—Å—Ç–∏ —Å—Ä–µ–¥—Å—Ç–≤: `hasEnoughFunds()`

```javascript
function hasEnoughFunds(ticketsToBuy) {
    const ticketPrice = 150; // –°—Ç–æ–∏–º–æ—Å—Ç—å –æ–¥–Ω–æ–≥–æ –±–∏–ª–µ—Ç–∞ –≤ —Ä—É–±–ª—è—Ö
    const requiredAmount = ticketPrice * ticketsToBuy;
    const userBalance = getUserBalance();
    
    console.log(`–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ä–µ–¥—Å—Ç–≤: ${userBalance} —Ä—É–±. –Ω–∞ —Å—á–µ—Ç—É, —Ç—Ä–µ–±—É–µ—Ç—Å—è ${requiredAmount} —Ä—É–±. –¥–ª—è ${ticketsToBuy} –±–∏–ª–µ—Ç–æ–≤`);
    
    return userBalance >= requiredAmount;
}
```

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—Ç–æ–∏–º–æ—Å—Ç–∏

- **–°—Ç–æ–∏–º–æ—Å—Ç—å –±–∏–ª–µ—Ç–∞**: 150 ‚ÇΩ
- **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å**: –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –±–∏–ª–µ—Ç–æ–≤
- **–ü—Ä–æ–≤–µ—Ä–∫–∞**: –±–∞–ª–∞–Ω—Å >= (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∏–ª–µ—Ç–æ–≤ √ó 150)

## –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

### –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –≤ Chrome Storage

```javascript
// –í –º–æ–¥—É–ª–µ state.js
async function saveAuthStatus() {
    const authStatus = {
        isLoggedIn: window.stolotoAuth.isUserLoggedIn(),
        balance: window.stolotoAuth.getUserBalance(),
        timestamp: Date.now()
    };
    
    await chrome.storage.local.set({ authStatus });
    console.log('–°—Ç–∞—Ç—É—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω:', authStatus);
}

// –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
async function loadAuthStatus() {
    const result = await chrome.storage.local.get(['authStatus']);
    return result.authStatus || { isLoggedIn: false, balance: 0 };
}
```

### –í–∞–ª–∏–¥–∞—Ü–∏—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

```javascript
function isAuthStatusValid(authStatus) {
    const maxAge = 5 * 60 * 1000; // 5 –º–∏–Ω—É—Ç
    const age = Date.now() - (authStatus.timestamp || 0);
    return age < maxAge;
}

async function getValidAuthStatus() {
    const cached = await loadAuthStatus();
    
    if (isAuthStatusValid(cached)) {
        return cached;
    }
    
    // –ö—ç—à —É—Å—Ç–∞—Ä–µ–ª, –ø–æ–ª—É—á–∞–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    const current = {
        isLoggedIn: window.stolotoAuth.isUserLoggedIn(),
        balance: window.stolotoAuth.getUserBalance(),
        timestamp: Date.now()
    };
    
    await chrome.storage.local.set({ authStatus: current });
    return current;
}
```

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ä–µ–∂–∏–º–æ–º –ø–æ–∫—É–ø–∫–∏

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–µ—Ä–µ–¥ –ø–æ–∫—É–ø–∫–æ–π

```javascript
// –í –º–æ–¥—É–ª–µ main.js
function setupMessageListener() {
    chrome.runtime.onMessage.addListener((request, sender, sendResponse) => {
        if (request.action === 'clickNumbers') {
            const needsAuth = request.isPurchaseMode;
            
            if (needsAuth && !window.stolotoAuth.isUserLoggedIn()) {
                console.log('‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –¥–ª—è —Ä–µ–∂–∏–º–∞ –ø–æ–∫—É–ø–∫–∏');
                window.stolotoUI.showAuthWarning();
                
                sendResponse({
                    status: 'error', 
                    message: '–î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ–∂–∏–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø–æ–∫—É–ø–∫–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è –Ω–∞ —Å–∞–π—Ç–µ –°—Ç–æ–ª–æ—Ç–æ'
                });
                return true;
            }
            
            // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ...
        }
    });
}
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ –ø–µ—Ä–µ–¥ –ø–æ–∫—É–ø–∫–æ–π

```javascript
// –í popup.js –∏–ª–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ–º —Ñ–∞–π–ª–µ
async function validatePurchaseRequest(ticketsToBuy) {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
    const authStatus = await checkUserLogin();
    if (!authStatus.isLoggedIn) {
        throw new Error('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω');
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–∞–ª–∞–Ω—Å
    const balanceCheck = await checkUserBalance(ticketsToBuy);
    if (!balanceCheck.hasEnoughFunds) {
        throw new Error(`–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤. –¢—Ä–µ–±—É–µ—Ç—Å—è: ${balanceCheck.requiredAmount} ‚ÇΩ, –¥–æ—Å—Ç—É–ø–Ω–æ: ${balanceCheck.balance} ‚ÇΩ`);
    }
    
    return true;
}
```

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å—Ç–∞—Ç—É—Å–∞

```javascript
let lastAuthStatus = null;

function monitorAuthStatus() {
    const currentStatus = window.stolotoAuth.isUserLoggedIn();
    
    if (lastAuthStatus !== null && lastAuthStatus !== currentStatus) {
        console.log('–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', lastAuthStatus, '->', currentStatus);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∫—ç—à
        saveAuthStatus();
        
        // –£–≤–µ–¥–æ–º–ª—è–µ–º popup
        chrome.runtime.sendMessage({
            action: 'authStatusChanged',
            isLoggedIn: currentStatus
        });
    }
    
    lastAuthStatus = currentStatus;
}

// –ó–∞–ø—É—Å–∫–∞–µ–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
setInterval(monitorAuthStatus, 30000);
```

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –ø–æ—Ç–µ—Ä–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

```javascript
function handleAuthLoss() {
    console.log('‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –ø–æ—Ç–µ—Ä—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏');
    
    // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–µ–∂–∏–º –ø–æ–∫—É–ø–∫–∏
    if (window.stolotoState.isPurchaseMode) {
        window.stolotoState.isPurchaseMode = false;
        window.stolotoState.resetPurchaseState();
        
        // –£–≤–µ–¥–æ–º–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        window.stolotoUI.showAuthWarning();
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
    saveAuthStatus();
}
```

## –û—Ç–ª–∞–¥–∫–∞ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

```javascript
// –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∞—è —Ñ—É–Ω–∫—Ü–∏—è
function debugAuthStatus() {
    console.group('üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏');
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
    const loginLink = document.querySelector('a[href*="/auth"]');
    const walletLink = document.querySelector('a[href="/private/wallet?int=header"]');
    const bonusLink = document.querySelector('a[href="/private/bonus?int=header"]');
    const ticketsLink = document.querySelector('a[href="/private/tickets/all?int=header"]');
    
    console.log('–°—Å—ã–ª–∫–∞ "–í—Ö–æ–¥ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è":', loginLink ? loginLink.textContent : '–Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
    console.log('–°—Å—ã–ª–∫–∞ –Ω–∞ –∫–æ—à–µ–ª–µ–∫:', walletLink ? walletLink.textContent : '–Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
    console.log('–°—Å—ã–ª–∫–∞ –Ω–∞ –±–æ–Ω—É—Å—ã:', bonusLink ? bonusLink.textContent : '–Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
    console.log('–°—Å—ã–ª–∫–∞ "–ú–æ–∏ –±–∏–ª–µ—Ç—ã":', ticketsLink ? '–Ω–∞–π–¥–µ–Ω–∞' : '–Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
    
    const isLoggedIn = window.stolotoAuth.isUserLoggedIn();
    const balance = window.stolotoAuth.getUserBalance();
    
    console.log('–°—Ç–∞—Ç—É—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', isLoggedIn ? '‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω' : '‚ùå –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω');
    console.log('–ë–∞–ª–∞–Ω—Å:', balance, '‚ÇΩ');
    
    console.groupEnd();
    
    return { isLoggedIn, balance, elements: { loginLink, walletLink, bonusLink, ticketsLink } };
}

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
window.addEventListener('load', () => {
    setTimeout(debugAuthStatus, 1000);
});
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

```javascript
// –¢–µ—Å—Ç–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
function testAuthFunctions() {
    console.group('üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏');
    
    try {
        // –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        const isLoggedIn = window.stolotoAuth.isUserLoggedIn();
        console.log('–¢–µ—Å—Ç isUserLoggedIn():', isLoggedIn ? 'PASS' : 'PASS (–Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω)');
        
        // –¢–µ—Å—Ç 2: –ü–æ–ª—É—á–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
        const balance = window.stolotoAuth.getUserBalance();
        console.log('–¢–µ—Å—Ç getUserBalance():', typeof balance === 'number' ? 'PASS' : 'FAIL');
        
        // –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ä–µ–¥—Å—Ç–≤
        const hasEnough1 = window.stolotoAuth.hasEnoughFunds(1);
        const hasEnough10 = window.stolotoAuth.hasEnoughFunds(10);
        console.log('–¢–µ—Å—Ç hasEnoughFunds(1):', typeof hasEnough1 === 'boolean' ? 'PASS' : 'FAIL');
        console.log('–¢–µ—Å—Ç hasEnoughFunds(10):', typeof hasEnough10 === 'boolean' ? 'PASS' : 'FAIL');
        
        console.log('‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã');
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –≤ —Ç–µ—Å—Ç–∞—Ö:', error);
    }
    
    console.groupEnd();
}
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏

1. **–î–æ–≤–µ—Ä–∏–µ –∫ DOM**
   - –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–æ —ç–ª–µ–º–µ–Ω—Ç–∞–º DOM
   - –í–æ–∑–º–æ–∂–Ω—ã –ª–æ–∂–Ω—ã–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å–∞–π—Ç–∞

2. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–µ—Ä–≤–µ—Ä–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏**
   - –ù–µ—Ç –ø—Ä—è–º–æ–≥–æ API –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
   - –ü–æ–ª–∞–≥–∞–µ–º—Å—è –Ω–∞ –∫–æ—Å–≤–µ–Ω–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏

3. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**
   - –°—Ç–∞—Ç—É—Å –º–æ–∂–µ—Ç —É—Å—Ç–∞—Ä–µ—Ç—å –º–µ–∂–¥—É –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏
   - –ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

1. **–†–µ–≥—É–ª—è—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞**
   ```javascript
   // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –ø–µ—Ä–µ–¥ –∫–∞–∂–¥–æ–π –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –æ–ø–µ—Ä–∞—Ü–∏–µ–π
   if (!window.stolotoAuth.isUserLoggedIn()) {
       throw new Error('–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è');
   }
   ```

2. **–í–∞–ª–∏–¥–∞—Ü–∏—è –±–∞–ª–∞–Ω—Å–∞**
   ```javascript
   // –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–∞–ª–∞–Ω—Å –ø–µ—Ä–µ–¥ –ø–æ–∫—É–ø–∫–æ–π
   const balance = window.stolotoAuth.getUserBalance();
   if (balance < requiredAmount) {
       throw new Error('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤');
   }
   ```

3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**
   ```javascript
   try {
       const result = await performPurchase();
   } catch (error) {
       if (error.message.includes('–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è')) {
           // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞
           window.location.href = '/auth';
       }
   }
   ```

## –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –≤–µ—Ä—Å–∏–∏ —Å–∞–π—Ç–∞
- –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è —Å–∞–π—Ç–∞ –°—Ç–æ–ª–æ—Ç–æ (2025)
- –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å Manifest V3

### –ü–ª–∞–Ω—ã —Ä–∞–∑–≤–∏—Ç–∏—è
1. **–£–ª—É—á—à–µ–Ω–Ω–∞—è –¥–µ—Ç–µ–∫—Ü–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏**
   - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
   - –ë–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã

2. **–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –±–∞–ª–∞–Ω—Å–æ–º**
   - –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
   - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–∏–∑–∫–æ–º –±–∞–ª–∞–Ω—Å–µ

3. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å API**
   - –ü—Ä—è–º—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ —Å–µ—Ä–≤–µ—Ä—É (–µ—Å–ª–∏ –ø–æ—è–≤–∏—Ç—Å—è API)
   - –ë–æ–ª–µ–µ —Ç–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ç–∞—Ç—É—Å–µ