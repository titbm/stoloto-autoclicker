# –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —Å–æ—Å—Ç–æ—è–Ω–∏–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

## –û–±–∑–æ—Ä

–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ "–°—Ç–æ–ª–æ—Ç–æ –ê–≤—Ç–æ–∫–ª–∏–∫–µ—Ä" —É–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Ç–∏–ø–∞–º–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –∏–∑–º–µ–Ω—è—é—Ç—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞. –ü–æ–Ω–∏–º–∞–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã.

## –°–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–∏—Å–∫–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è

#### not_started
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –ø–æ–∏—Å–∫ –Ω–µ –∑–∞–ø—É—â–µ–Ω
- **–£—Å–ª–æ–≤–∏—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏**: 
  - –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
  - –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –ø–æ–∏—Å–∫–∞
  - –ü–æ—Å–ª–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–æ–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
- **–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã**: 
  - `isSearching = false`
  - –ö–Ω–æ–ø–∫–∞ "–ó–∞–ø—É—Å—Ç–∏—Ç—å" –∞–∫—Ç–∏–≤–Ω–∞
  - –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –±–ª–æ–∫ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–∏—Å–∫–∞

#### searching
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –ê–∫—Ç–∏–≤–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –ø–æ–∏—Å–∫–∞ –±–∏–ª–µ—Ç–æ–≤
- **–£—Å–ª–æ–≤–∏—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏**:
  - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∞–ª –∫–Ω–æ–ø–∫—É "–ó–∞–ø—É—Å—Ç–∏—Ç—å"
  - –£—Å–ø–µ—à–Ω–æ –≤—ã–±—Ä–∞–Ω—ã —á–∏—Å–ª–∞ –∏ –Ω–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ "–ü–æ–∫–∞–∑–∞—Ç—å –±–∏–ª–µ—Ç—ã"
- **–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã**:
  - `isSearching = true`
  - –ö–Ω–æ–ø–∫–∞ "–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å" –∞–∫—Ç–∏–≤–Ω–∞
  - –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –±–ª–æ–∫ —Å—Ç–∞—Ç—É—Å–∞ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø–æ–∏—Å–∫–µ
  - –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è —Å—á–µ—Ç—á–∏–∫ `ticketsChecked`

#### found
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –ù–∞–π–¥–µ–Ω –ø–æ–¥—Ö–æ–¥—è—â–∏–π –±–∏–ª–µ—Ç, –Ω–æ –ø—Ä–æ—Ü–µ—Å—Å –µ—â–µ –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω
- **–£—Å–ª–æ–≤–∏—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏**:
  - –§—É–Ω–∫—Ü–∏—è `analyzeTicket()` –≤–µ—Ä–Ω—É–ª–∞ `true` –¥–ª—è –±–∏–ª–µ—Ç–∞
  - –í –æ–±—ã—á–Ω–æ–º —Ä–µ–∂–∏–º–µ: –±–∏–ª–µ—Ç –≤—ã–±—Ä–∞–Ω, –Ω–æ —Å—Ç–∞—Ç—É—Å –µ—â–µ –Ω–µ –æ–±–Ω–æ–≤–ª–µ–Ω
  - –í —Ä–µ–∂–∏–º–µ –ø–æ–∫—É–ø–∫–∏: –±–∏–ª–µ—Ç –Ω–∞–π–¥–µ–Ω, –Ω–æ –ø–æ–∫—É–ø–∫–∞ –µ—â–µ –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∞
- **–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã**:
  - `isSearching = true` (–µ—â–µ –∞–∫—Ç–∏–≤–µ–Ω)
  - –ë–∏–ª–µ—Ç –≤—ã–¥–µ–ª–µ–Ω –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
  - –í —Ä–µ–∂–∏–º–µ –ø–æ–∫—É–ø–∫–∏: –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–Ω–æ–ø–∫–∏ –æ–ø–ª–∞—Ç—ã

#### completed
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –ü–æ–∏—Å–∫ —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω
- **–£—Å–ª–æ–≤–∏—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏**:
  - –í –æ–±—ã—á–Ω–æ–º —Ä–µ–∂–∏–º–µ: –Ω–∞–π–¥–µ–Ω –∏ –≤—ã–±—Ä–∞–Ω –ø–æ–¥—Ö–æ–¥—è—â–∏–π –±–∏–ª–µ—Ç
  - –í —Ä–µ–∂–∏–º–µ –ø–æ–∫—É–ø–∫–∏: –¥–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –∫—É–ø–ª–µ–Ω–Ω—ã—Ö –±–∏–ª–µ—Ç–æ–≤
- **–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã**:
  - `isSearching = false`
  - –ë–ª–æ–∫ —Å—Ç–∞—Ç—É—Å–∞ –∑–µ–ª–µ–Ω–æ–≥–æ —Ü–≤–µ—Ç–∞
  - –ö–Ω–æ–ø–∫–∞ "–ó–∞–ø—É—Å—Ç–∏—Ç—å" —Å–Ω–æ–≤–∞ –∞–∫—Ç–∏–≤–Ω–∞
  - –í —Ä–µ–∂–∏–º–µ –ø–æ–∫—É–ø–∫–∏: `ticketsPurchased >= totalTicketsToBuy`

### –î–∏–∞–≥—Ä–∞–º–º–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ —Å–æ—Å—Ç–æ—è–Ω–∏–π –ø–æ–∏—Å–∫–∞

```
not_started ‚Üí searching ‚Üí found ‚Üí completed
     ‚Üë           ‚Üì         ‚Üì         ‚Üì
     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           (–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º)
```

## –°–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–∫—É–ø–∫–∏

### –û—Å–Ω–æ–≤–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è

#### idle
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –†–µ–∂–∏–º –ø–æ–∫—É–ø–∫–∏ –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω
- **–£—Å–ª–æ–≤–∏—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏**:
  - –ß–µ–∫–±–æ–∫—Å —Ä–µ–∂–∏–º–∞ –ø–æ–∫—É–ø–∫–∏ –Ω–µ –æ—Ç–º–µ—á–µ–Ω
  - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
  - –ó–∞–≤–µ—Ä—à–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∞ –≤—Å–µ—Ö –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –±–∏–ª–µ—Ç–æ–≤
- **–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã**:
  - `isPurchaseMode = false`
  - `totalTicketsToBuy = 0`
  - `ticketsPurchased = 0`

#### purchasing
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –ê–∫—Ç–∏–≤–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –ø–æ–∏—Å–∫–∞ –∏ –ø–æ–∫—É–ø–∫–∏ –±–∏–ª–µ—Ç–æ–≤
- **–£—Å–ª–æ–≤–∏—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏**:
  - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–ª —Ä–µ–∂–∏–º –ø–æ–∫—É–ø–∫–∏
  - `ticketsPurchased < totalTicketsToBuy`
  - –ù–∞–π–¥–µ–Ω –ø–æ–¥—Ö–æ–¥—è—â–∏–π –±–∏–ª–µ—Ç –∏ –¥–æ—Å—Ç—É–ø–Ω—ã –∫–Ω–æ–ø–∫–∏ –æ–ø–ª–∞—Ç—ã
- **–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã**:
  - `isPurchaseMode = true`
  - –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ–∫—É–ø–∫–∏ –≤ –±–ª–æ–∫–µ —Å—Ç–∞—Ç—É—Å–∞
  - –ê–∫—Ç–∏–≤–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏ `savePurchaseState()` –∏ `loadPurchaseState()`

#### payment
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –ü—Ä–æ—Ü–µ—Å—Å –æ–ø–ª–∞—Ç—ã –±–∏–ª–µ—Ç–∞
- **–£—Å–ª–æ–≤–∏—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏**:
  - –ù–∞–π–¥–µ–Ω –ø–æ–¥—Ö–æ–¥—è—â–∏–π –±–∏–ª–µ—Ç
  - –ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ "–û–ø–ª–∞—Ç–∏—Ç—å –∫–æ—à–µ–ª—å–∫–æ–º"
  - –û–∂–∏–¥–∞–µ—Ç—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–ø–ª–∞—Ç—ã
- **–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã**:
  - –û—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–Ω–æ–ø–∫–∏ –æ–ø–ª–∞—Ç—ã
  - –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∑–∞–¥–µ—Ä–∂–∫–∞ 5 —Å–µ–∫—É–Ω–¥ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ–ø–ª–∞—Ç—ã
  - –ë–ª–æ–∫ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –æ–ø–ª–∞—Ç—ã

#### completed
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –ü–æ–∫—É–ø–∫–∞ –≤—Å–µ—Ö –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –±–∏–ª–µ—Ç–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω–∞
- **–£—Å–ª–æ–≤–∏—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏**:
  - `ticketsPurchased >= totalTicketsToBuy`
  - –í—Å–µ –±–∏–ª–µ—Ç—ã —É—Å–ø–µ—à–Ω–æ –æ–ø–ª–∞—á–µ–Ω—ã
- **–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã**:
  - –ë–ª–æ–∫ —Å—Ç–∞—Ç—É—Å–∞ –∑–µ–ª–µ–Ω–æ–≥–æ —Ü–≤–µ—Ç–∞ —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏
  - –í—ã–∑—ã–≤–∞–µ—Ç—Å—è `resetPurchaseState()`
  - –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–∫—É–ø–∫–∏ –æ—á–∏—â–∞–µ—Ç—Å—è –∏–∑ Chrome Storage

### –î–∏–∞–≥—Ä–∞–º–º–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ —Å–æ—Å—Ç–æ—è–Ω–∏–π –ø–æ–∫—É–ø–∫–∏

```
idle ‚Üí purchasing ‚Üí payment ‚Üí completed
 ‚Üë         ‚Üì          ‚Üì          ‚Üì
 ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
      (—Å–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è)
```

## –£—Å–ª–æ–≤–∏—è –ø–µ—Ä–µ—Ö–æ–¥–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π

### –¢—Ä–∏–≥–≥–µ—Ä—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–π

#### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è
- **–ù–∞–∂–∞—Ç–∏–µ "–ó–∞–ø—É—Å—Ç–∏—Ç—å"**: `not_started` ‚Üí `searching`
- **–ù–∞–∂–∞—Ç–∏–µ "–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å"**: `searching` ‚Üí `not_started`
- **–ê–∫—Ç–∏–≤–∞—Ü–∏—è —Ä–µ–∂–∏–º–∞ –ø–æ–∫—É–ø–∫–∏**: `idle` ‚Üí `purchasing`
- **–î–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è —Ä–µ–∂–∏–º–∞ –ø–æ–∫—É–ø–∫–∏**: `purchasing` ‚Üí `idle`

#### –°–∏—Å—Ç–µ–º–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
- **–ù–∞–π–¥–µ–Ω –ø–æ–¥—Ö–æ–¥—è—â–∏–π –±–∏–ª–µ—Ç**: `searching` ‚Üí `found`
- **–ë–∏–ª–µ—Ç —É—Å–ø–µ—à–Ω–æ –≤—ã–±—Ä–∞–Ω**: `found` ‚Üí `completed` (–æ–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º)
- **–ë–∏–ª–µ—Ç —É—Å–ø–µ—à–Ω–æ –æ–ø–ª–∞—á–µ–Ω**: `payment` ‚Üí `purchasing` (–µ—Å–ª–∏ –Ω—É–∂–Ω—ã –µ—â–µ –±–∏–ª–µ—Ç—ã)
- **–î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –ø–æ–∫—É–ø–æ–∫**: `purchasing` ‚Üí `completed`

#### –û—à–∏–±–∫–∏ –∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è
- **–ü–æ—Ç–µ—Ä—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏**: `purchasing` ‚Üí `idle`
- **–ù–µ–¥–æ—Å—Ç–∞—Ç–æ–∫ —Å—Ä–µ–¥—Å—Ç–≤**: `purchasing` ‚Üí `idle`
- **–û—à–∏–±–∫–∞ —Å–µ—Ç–∏**: –ª—é–±–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ ‚Üí `not_started`

### –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–µ—Ä–µ—Ö–æ–¥–æ–≤

```javascript
function validateStateTransition(currentState, newState, context) {
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –¥–ª—è —Ä–µ–∂–∏–º–∞ –ø–æ–∫—É–ø–∫–∏
    if (newState === 'purchasing' && !isUserLoggedIn()) {
        console.log('‚ùå –ü–µ—Ä–µ—Ö–æ–¥ –≤ —Ä–µ–∂–∏–º –ø–æ–∫—É–ø–∫–∏ –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω');
        return false;
    }
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ—Å—Ç–∏ —Å—Ä–µ–¥—Å—Ç–≤
    if (newState === 'payment' && !hasEnoughFunds(context.ticketsToBuy)) {
        console.log('‚ùå –ü–µ—Ä–µ—Ö–æ–¥ –∫ –æ–ø–ª–∞—Ç–µ –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω: –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤');
        return false;
    }
    
    return true;
}
```

## –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏

### –ü—Ä–æ—Ü–µ–¥—É—Ä–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

#### –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ content.js

1. **–ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–∫—É–ø–∫–∏**:
   ```javascript
   async function loadPurchaseState() {
       const data = await chrome.storage.local.get('purchaseState');
       if (data.purchaseState) {
           // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
           isPurchaseMode = data.purchaseState.isPurchaseMode;
           totalTicketsToBuy = data.purchaseState.totalTicketsToBuy;
           ticketsPurchased = data.purchaseState.ticketsPurchased;
           // ...
       }
   }
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏**:
   ```javascript
   if (isPurchaseMode && !isUserLoggedIn()) {
       console.log('‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã—à–µ–ª –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞, –æ—Ç–º–µ–Ω—è–µ–º —Ä–µ–∂–∏–º –ø–æ–∫—É–ø–∫–∏');
       await resetPurchaseState();
       return;
   }
   ```

3. **–ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞**:
   ```javascript
   if (isPurchaseMode && ticketsPurchased < totalTicketsToBuy) {
       // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫–∏ –∏ –≤—Ä–µ–º—è
       ticketsChecked = purchaseTicketsChecked;
       searchStartTime = purchaseStartTime;
       
       // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –ø–æ–∏—Å–∫ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
       setTimeout(() => {
           clearSelection().then(() => {
               clickNumbers(purchaseSearchNumbers, purchaseSearchMode, purchaseExcludeNumbers);
           });
       }, 1500);
   }
   ```

#### –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ popup.js

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏**:
   ```javascript
   await checkAuthFromStorage();
   updateAuthDependentUI();
   ```

2. **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–æ–∏—Å–∫–∞**:
   ```javascript
   await loadLastSearchParams();
   ```

3. **–í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–µ–∂–∏–º–∞ –ø–æ–∫—É–ø–∫–∏**:
   ```javascript
   if (data.lastSearch.isPurchaseMode && currentAuthStatus) {
       testPurchaseModeCheckbox.checked = true;
       purchaseOptionsContainer.style.display = 'block';
   }
   ```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Å–æ—Å—Ç–æ—è–Ω–∏–π

#### –ö–æ–Ω—Ñ–ª–∏–∫—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
```javascript
// –ï—Å–ª–∏ —Ä–µ–∂–∏–º –ø–æ–∫—É–ø–∫–∏ –∞–∫—Ç–∏–≤–µ–Ω, –Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
if (isPurchaseMode && !isUserLoggedIn()) {
    showAuthWarning();
    await resetPurchaseState();
}
```

#### –ö–æ–Ω—Ñ–ª–∏–∫—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–µ—Ç–æ–∫
```javascript
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
const isRecent = (Date.now() - data.authStatus.timestamp) < 10 * 1000;
if (!isRecent) {
    // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å
    return await checkActiveTabAuth();
}
```

#### –ö–æ–Ω—Ñ–ª–∏–∫—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–∫—É–ø–∫–∏
```javascript
// –ï—Å–ª–∏ –ø–æ–∫—É–ø–∫–∞ —É–∂–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∞, –Ω–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–µ —Å–±—Ä–æ—à–µ–Ω–æ
if (ticketsPurchased >= totalTicketsToBuy) {
    await resetPurchaseState();
    return;
}
```

## –û—Ç–ª–∞–¥–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤

```javascript
function logStateTransition(from, to, reason) {
    console.log(`üîÑ –ü–µ—Ä–µ—Ö–æ–¥ —Å–æ—Å—Ç–æ—è–Ω–∏—è: ${from} ‚Üí ${to} (${reason})`);
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Chrome Storage –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
    chrome.storage.local.set({
        lastStateTransition: {
            from: from,
            to: to,
            reason: reason,
            timestamp: Date.now()
        }
    });
}
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏–π

```javascript
function monitorStates() {
    setInterval(() => {
        console.log('üìä –¢–µ–∫—É—â–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è:', {
            isSearching: isSearching,
            isPurchaseMode: isPurchaseMode,
            ticketsPurchased: ticketsPurchased,
            totalTicketsToBuy: totalTicketsToBuy,
            ticketsChecked: ticketsChecked
        });
    }, 5000);
}
```

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

#### –ó–∞–≤–∏—Å—à–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–∏—Å–∫–∞
```javascript
// –ï—Å–ª–∏ –ø–æ–∏—Å–∫ –∞–∫—Ç–∏–≤–µ–Ω –±–æ–ª–µ–µ 10 –º–∏–Ω—É—Ç –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
if (isSearching && (Date.now() - searchStartTime) > 10 * 60 * 1000) {
    console.log('‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –∑–∞–≤–∏—Å—à–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–∏—Å–∫–∞');
    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π —Å–±—Ä–æ—Å
    isSearching = false;
    removeStatusBlock();
}
```

#### –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–∫—É–ø–∫–∏
```javascript
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–∏—á–µ—Å–∫–æ–π —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏
if (isPurchaseMode && totalTicketsToBuy === 0) {
    console.log('‚ö†Ô∏è –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–∫—É–ø–∫–∏: —Ä–µ–∂–∏–º –∞–∫—Ç–∏–≤–µ–Ω, –Ω–æ –ª–∏–º–∏—Ç –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω');
    await resetPurchaseState();
}
```

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏

### Best Practices

1. **–í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ø—Ä–µ–¥—É—Å–ª–æ–≤–∏—è** –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –≤ –Ω–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏** –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–æ—Å—Ç–æ—è–Ω–∏—è
3. **–õ–æ–≥–∏—Ä—É–π—Ç–µ –≤—Å–µ –ø–µ—Ä–µ—Ö–æ–¥—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π** –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è –æ—Ç–ª–∞–¥–∫–∏
4. **–í–∞–ª–∏–¥–∏—Ä—É–π—Ç–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ** –ø–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑ Chrome Storage
5. **–ü—Ä–µ–¥—É—Å–º–∞—Ç—Ä–∏–≤–∞–π—Ç–µ –æ—Ç–∫–∞—Ç** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è

### –ê–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω—ã

1. **–ù–µ –∏–∑–º–µ–Ω—è–π—Ç–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ** –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–µ–∫—É—â–µ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
2. **–ù–µ –ø–æ–ª–∞–≥–∞–π—Ç–µ—Å—å –Ω–∞ –ø–æ—Ä—è–¥–æ–∫** –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
3. **–ù–µ –∏–≥–Ω–æ—Ä–∏—Ä—É–π—Ç–µ –æ—à–∏–±–∫–∏** –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏/–∑–∞–≥—Ä—É–∑–∫–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
4. **–ù–µ —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** –º–µ–∂–¥—É —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏
5. **–ù–µ –∑–∞–±—ã–≤–∞–π—Ç–µ –æ—á–∏—â–∞—Ç—å** –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π