---
applyTo: "**"
---

# Столото Автокликер - Краткие знания о проекте

## ДЕЙСТВОВАТЬ ТОЛЬКО ТАК И НИКАК ИНАЧЕ

**Перед любыми изменениями в основном коде приложения:**

1. Внедрять все маленькими шагами. Чем меньше исправлений, тем лучше.

2. **ИЗУЧИТЬ САЙТ** (когда это улучшит результат) - исследовать актуальное состояние сайта Столото:
   - Неавторизованное состояние: использовать playwright MCP
   - Авторизованное состояние: использовать browser MCP (если доступно)

3. **ОБЪЯСНИТЬ** - что именно планируется изменить и почему

4. **СПРОСИТЬ РАЗРЕШЕНИЯ** - получить явное одобрение от пользователя  

5. **ТОЛЬКО ПОСЛЕ ОДОБРЕНИЯ** - вносить изменения в код

Это касается всех файлов кода приложения (popup.js, content.js, background.js, modules/, manifest.json и т.д.)

Документацию можно изменять без разрешения.

## АКТУАЛЬНЫЕ СЕЛЕКТОРЫ САЙТА

### Новая структура сайта (обновлено: 24.07.2025)
- **Стартовая страница**: `https://www.stoloto.ru/ruslotto/game?viewType=tickets`
- **Кнопка "Выбрать числа"**: `button` с текстом "Выбрать числа" - НОВЫЙ обязательный шаг!

### Числа и кнопки (обновлено: 24.07.2025)
- Кнопки чисел 1-90: `button` с текстом числа (в модальном окне после нажатия "Выбрать числа")
- Кнопка "Показать билеты": `button` с текстом "Показать билеты"
- Кнопка "Сбросить": `button` с текстом "Сбросить"
- Кнопка "Другие билеты": `button` с текстом "Другие билеты"

### Билеты (обновлено: 24.07.2025)
- Кнопки билетов: `button` содержащий текст "Билет №"
- Числа в билете: `generic` элементы с числовым содержимым (от 1 до 90)
- Структура: числа больше не используют `data-test-id`, находятся в простых generic элементах

### Авторизация (обновлено: не проверялось)
- **Неавторизованное состояние**: ссылка "Вход и регистрация" `a[href*="/auth"]`
- **Авторизованное состояние**: 
  - Баланс: `a[href="/private/wallet?int=header"]` (формат: "X ₽")
  - Бонусы: `a[href="/private/bonus?int=header"]` (формат: число)
  - Мои билеты: `a[href="/private/tickets/all?int=header"]`

## РАЗЛИЧИЯ АВТОРИЗОВАННОГО/НЕАВТОРИЗОВАННОГО СОСТОЯНИЯ

### Неавторизованное состояние
- Присутствует ссылка "Вход и регистрация"
- Отсутствуют элементы баланса, бонусов, личного кабинета
- Доступен только просмотр билетов без покупки

### Авторизованное состояние  
- Отсутствует ссылка "Вход и регистрация"
- Присутствуют ссылки на баланс, бонусы, мои билеты
- Доступна покупка билетов
- Отображается текущий баланс в формате "X ₽"

## СТРУКТУРА ФАЙЛОВ ПРОЕКТА

### Основные файлы расширения
- **manifest.json** - конфигурация расширения (Manifest V3)
- **popup.html** - HTML интерфейс расширения
- **popup.js** - логика интерфейса, обработка пользовательского ввода
- **content.js** - точка входа, координирует работу модулей на странице
- **background.js** - фоновый скрипт (service worker)

### Модульная система (modules/)
- **utils.js** - вспомогательные функции общего назначения
- **state.js** - управление глобальным состоянием приложения
- **ui.js** - управление пользовательским интерфейсом на странице
- **auth.js** - авторизация и работа с балансом пользователя
- **payment.js** - обработка платежей и покупок
- **search.js** - поиск и анализ билетов
- **main.js** - основная логика координации и обработка сообщений

## ЛОГИКА РАБОТЫ ПРИЛОЖЕНИЯ

### Основной поток работы
1. **Пользователь открывает popup** → вводит числа для поиска
2. **popup.js отправляет команду** → через chrome.tabs.sendMessage в main.js
3. **main.js координирует процесс**:
   - Проверяет авторизацию (для режима покупки)
   - Очищает предыдущий выбор через search.js
   - Выбирает числа на странице
   - Нажимает "Показать билеты"
4. **search.js анализирует билеты** → проверяет каждый билет на соответствие критериям
5. **При найденном билете**:
   - Обычный режим: выбирает билет и останавливается
   - Режим покупки: покупает билет через payment.js, продолжает до лимита

### Режимы поиска
- **anywhere** - числа где угодно в билете
- **half** - числа в одной половине билета (строки 1-3 или 4-6)  
- **row** - числа в одной строке билета

### Состояние и синхронизация
- **state.js** сохраняет прогресс в Chrome Storage
- При перезагрузке страницы автоматически восстанавливает и продолжает процесс
- **ui.js** отображает статус поиска в реальном времени