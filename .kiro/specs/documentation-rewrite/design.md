# Дизайн переписывания документации

## Обзор

Документация проекта "Столото Автокликер" будет полностью переписана с учетом текущей модульной архитектуры и новых функций. Новая документация будет структурирована как современный справочник разработчика с акцентом на практическое применение и актуальность информации.

## Архитектура

### Структура документации

Документация будет организована в существующей структуре `docs/` с обновленным содержанием:

```
docs/
├── README.md                     # Главная страница документации
├── architecture/
│   ├── extension-overview.md     # Обзор архитектуры расширения
│   ├── module-system.md          # Модульная система и загрузка
│   ├── component-interaction.md  # Взаимодействие компонентов
│   └── chrome-apis.md           # Используемые Chrome API
├── stoloto-integration/
│   ├── dom-structure.md         # Структура DOM сайта
│   ├── selectors-reference.md   # Справочник селекторов
│   ├── user-flows.md           # Пользовательские сценарии
│   └── authentication.md       # Система авторизации
├── algorithms/
│   ├── search-modes.md         # Режимы поиска билетов
│   ├── ticket-analysis.md      # Анализ билетов
│   ├── purchase-automation.md  # Автоматическая покупка
│   └── anti-blocking.md       # Защита от блокировки
├── state-management/
│   ├── global-state.md         # Глобальное состояние
│   ├── storage-schema.md       # Схема Chrome Storage
│   ├── lifecycle.md           # Жизненный цикл состояний
│   └── synchronization.md     # Синхронизация данных
└── development/
    ├── modules-reference.md    # Справочник модулей
    ├── functions-reference.md  # Справочник функций
    ├── patterns.md            # Паттерны разработки
    └── debugging.md           # Отладка и тестирование
```

### Принципы организации контента

1. **Актуальность** - вся информация соответствует текущему коду
2. **Модульность** - документация отражает модульную архитектуру
3. **Практичность** - акцент на примеры кода и реальные сценарии
4. **Полнота** - покрытие всех аспектов функциональности

## Компоненты и интерфейсы

### Архитектурная документация

#### Extension Overview (`architecture/extension-overview.md`)
- **Назначение**: Обзор современной архитектуры расширения
- **Содержание**:
  - Manifest V3 конфигурация и permissions
  - Роль popup.html/popup.js в пользовательском интерфейсе
  - Content script как точка входа (content.js)
  - Background service worker (background.js)
  - Модульная система и принципы организации кода

#### Module System (`architecture/module-system.md`)
- **Назначение**: Описание модульной архитектуры
- **Содержание**:
  - Структура папки modules/ и назначение каждого модуля
  - Система экспорта в глобальное пространство window
  - Порядок загрузки модулей через manifest.json
  - Зависимости между модулями и их разрешение
  - Паттерны инициализации и проверки загрузки

#### Component Interaction (`architecture/component-interaction.md`)
- **Назначение**: Взаимодействие между компонентами
- **Содержание**:
  - Коммуникация popup ↔ content script через chrome.runtime.sendMessage
  - Обработка сообщений в main.js через setupMessageListener
  - Синхронизация состояния через Chrome Storage API
  - Обработка ошибок и восстановление соединения
  - Жизненный цикл сообщений и таймауты

#### Chrome APIs (`architecture/chrome-apis.md`)
- **Назначение**: Справочник используемых Chrome API
- **Содержание**:
  - chrome.storage.local - схема данных и паттерны использования
  - chrome.tabs - управление вкладками и отправка сообщений
  - chrome.runtime - обмен сообщениями и обработка событий
  - chrome.action - управление иконкой расширения
  - Обработка ошибок API и best practices

### Интеграция со Столото

#### DOM Structure (`stoloto-integration/dom-structure.md`)
- **Назначение**: Актуальная структура сайта Столото
- **Содержание**:
  - Структура билета и расположение чисел (6 строк по 9 чисел)
  - Элементы управления выбором чисел
  - Кнопки навигации и пагинации
  - Индикаторы загрузки и состояния страницы
  - Элементы авторизации и пользовательского профиля

#### Selectors Reference (`stoloto-integration/selectors-reference.md`)
- **Назначение**: Полный справочник CSS селекторов
- **Содержание**:
  - Селекторы чисел: `[data-test-id="number"]`, `[data-test-id="selected-number"]`
  - Селекторы билетов: `button[class*="Ticket_btn"]`, `[data-test-id="ticket-number"]`
  - Кнопки управления: "Показать билеты", "Другие билеты", "Очистить"
  - Селекторы авторизации: `a[href*="/auth"]`, `a[href="/private/wallet?int=header"]`
  - Селекторы оплаты: кнопки "Оплатить кошельком", QR-оплата

#### User Flows (`stoloto-integration/user-flows.md`)
- **Назначение**: Пользовательские сценарии работы
- **Содержание**:
  - Процесс выбора чисел и генерации билетов
  - Навигация между страницами билетов
  - Сценарий автоматической покупки билетов
  - Проверка авторизации и баланса пользователя
  - Обработка ошибок и восстановление

#### Authentication (`stoloto-integration/authentication.md`)
- **Назначение**: Система авторизации и работа с балансом
- **Содержание**:
  - Определение статуса авторизации через isUserLoggedIn()
  - Получение баланса из ссылки на кошелек
  - Кэширование статуса авторизации в Chrome Storage
  - Проверка достаточности средств для покупки
  - Обработка изменений статуса авторизации

### Алгоритмы и логика

#### Search Modes (`algorithms/search-modes.md`)
- **Назначение**: Детальное описание режимов поиска
- **Содержание**:
  - Режим "anywhere": поиск чисел в любом месте билета
  - Режим "half": поиск в верхней (1-3) или нижней (4-6) половине
  - Режим "row": поиск всех чисел в одной строке
  - Логика группировки чисел по строкам (по 9 чисел)
  - Примеры кода для каждого режима

#### Ticket Analysis (`algorithms/ticket-analysis.md`)
- **Назначение**: Анализ билетов и валидация
- **Содержание**:
  - Функция analyzeTicket() и её логика
  - Парсинг чисел из DOM элементов билета
  - Фильтрация исключаемых чисел
  - Валидация структуры билета (6 строк)
  - Обработка некорректных данных

#### Purchase Automation (`algorithms/purchase-automation.md`)
- **Назначение**: Автоматическая покупка билетов
- **Содержание**:
  - Логика режима покупки в findSuitableTicket()
  - Проверка кнопок оплаты через checkPaymentButtons()
  - Процесс нажатия на кнопку "Оплатить кошельком"
  - Подсчет купленных билетов и управление лимитами
  - Перезагрузка страницы для продолжения покупки

#### Anti-blocking (`algorithms/anti-blocking.md`)
- **Назначение**: Защита от блокировки сайтом
- **Содержание**:
  - Случайные задержки между действиями (250-1000мс)
  - Имитация человеческого поведения при кликах
  - Обработка таймаутов и сетевых ошибок
  - Восстановление после перезагрузки страницы
  - Стратегии graceful degradation

### Управление состоянием

#### Global State (`state-management/global-state.md`)
- **Назначение**: Глобальное состояние приложения
- **Содержание**:
  - Объект window.stolotoState и его структура
  - Состояние поиска: isSearching, searchMode, ticketsChecked
  - Состояние покупки: isPurchaseMode, totalTicketsToBuy, ticketsPurchased
  - Временные метки и счетчики
  - Синхронизация между режимами поиска и покупки

#### Storage Schema (`state-management/storage-schema.md`)
- **Назначение**: Схема данных Chrome Storage
- **Содержание**:
  - Структура purchaseState для режима покупки
  - Объект lastSearch для сохранения параметров
  - Кэш authStatus для статуса авторизации
  - Временные метки и валидация данных
  - Примеры сохранения и загрузки данных

#### Lifecycle (`state-management/lifecycle.md`)
- **Назначение**: Жизненный цикл состояний
- **Содержание**:
  - Инициализация состояния при загрузке страницы
  - Переходы между состояниями поиска и покупки
  - Сохранение состояния перед перезагрузкой
  - Восстановление состояния после перезагрузки
  - Сброс состояния при завершении операций

#### Synchronization (`state-management/synchronization.md`)
- **Назначение**: Синхронизация данных
- **Содержание**:
  - Обмен сообщениями между popup и content script
  - Обновление UI в реальном времени
  - Сохранение промежуточных результатов
  - Разрешение конфликтов данных
  - Восстановление синхронизации после ошибок

### Справочная документация

#### Modules Reference (`development/modules-reference.md`)
- **Назначение**: Справочник модулей системы
- **Содержание**:
  - main.js: координация и основная логика
  - state.js: управление состоянием
  - auth.js: авторизация и баланс
  - search.js: поиск и анализ билетов
  - ui.js: пользовательский интерфейс
  - payment.js: обработка платежей
  - utils.js: вспомогательные функции

#### Functions Reference (`development/functions-reference.md`)
- **Назначение**: Справочник ключевых функций
- **Содержание**:
  - clickNumbers(): основная функция поиска
  - analyzeTicket(): анализ билета
  - isUserLoggedIn(): проверка авторизации
  - getUserBalance(): получение баланса
  - savePurchaseState()/loadPurchaseState(): управление состоянием
  - updateStatusBlock(): обновление UI

#### Patterns (`development/patterns.md`)
- **Назначение**: Паттерны разработки
- **Содержание**:
  - Модульная архитектура и экспорт в window
  - Асинхронные паттерны с async/await
  - Обработка ошибок и graceful degradation
  - Работа с DOM и селекторами
  - Паттерны обмена сообщениями

#### Debugging (`development/debugging.md`)
- **Назначение**: Отладка и тестирование
- **Содержание**:
  - Использование console.log для трассировки
  - Отладка через Chrome DevTools
  - Тестирование на реальном сайте Столото
  - Диагностика проблем авторизации
  - Отладка состояния и синхронизации

## Модели данных

### Структура модулей

```typescript
interface ModuleStructure {
  name: string;              // Название модуля
  filename: string;          // Имя файла
  exports: string[];         // Экспортируемые функции
  dependencies: string[];    // Зависимости от других модулей
  globalNamespace: string;   // Пространство имен в window
  description: string;       // Описание назначения
}

interface FunctionSignature {
  name: string;             // Название функции
  module: string;           // Модуль, в котором определена
  signature: string;        // Сигнатура функции
  parameters: Parameter[];  // Параметры
  returnType: string;       // Тип возвращаемого значения
  isAsync: boolean;         // Асинхронная функция
  description: string;      // Описание назначения
  examples: CodeExample[];  // Примеры использования
}
```

### Схема состояния

```typescript
interface GlobalState {
  // Состояние поиска
  isSearching: boolean;
  searchMode: 'anywhere' | 'half' | 'row';
  ticketsChecked: number;
  searchStartTime: number | null;
  
  // Состояние покупки
  isPurchaseMode: boolean;
  totalTicketsToBuy: number;
  ticketsPurchased: number;
  purchaseSearchNumbers: number[];
  purchaseExcludeNumbers: number[];
  purchaseSearchMode: 'anywhere' | 'half' | 'row';
  purchaseTicketsChecked: number;
  purchaseStartTime: number | null;
}

interface StorageSchema {
  purchaseState: PurchaseState;
  lastSearch: LastSearchParams;
  authStatus: AuthenticationStatus;
}
```

### Селекторы и элементы

```typescript
interface SelectorReference {
  element: string;          // Описание элемента
  selector: string;         // CSS селектор
  purpose: string;          // Назначение
  module: string;           // Модуль, где используется
  isStable: boolean;        // Стабильность селектора
  alternatives: string[];   // Альтернативные селекторы
  lastVerified: Date;       // Дата последней проверки
}

interface UserFlow {
  name: string;             // Название сценария
  steps: FlowStep[];        // Шаги сценария
  triggers: string[];       // Триггеры запуска
  expectedOutcome: string;  // Ожидаемый результат
  errorHandling: string[];  // Обработка ошибок
}
```

## Обработка ошибок

### Стратегии обработки ошибок в документации

1. **Устаревшая информация**
   - Регулярная проверка актуальности селекторов
   - Сравнение с текущим кодом проекта
   - Автоматические уведомления об изменениях

2. **Неполная документация**
   - Чек-листы для каждого типа документа
   - Валидация покрытия всех функций
   - Проверка наличия примеров кода

3. **Несоответствие реальности**
   - Тестирование примеров на реальном сайте
   - Проверка селекторов через браузерные инструменты
   - Валидация API вызовов

### Процедуры валидации

- **Технические примеры**: все примеры кода должны быть протестированы
- **Селекторы DOM**: регулярная проверка на актуальном сайте
- **Функциональность**: тестирование описанных сценариев
- **Ссылки**: проверка внутренних и внешних ссылок

## Стратегия тестирования

### Подходы к тестированию документации

1. **Структурное тестирование**
   - Проверка полноты разделов
   - Валидация формата Markdown
   - Тестирование навигации

2. **Содержательное тестирование**
   - Проверка актуальности примеров
   - Валидация селекторов на сайте
   - Тестирование алгоритмов

3. **Пользовательское тестирование**
   - Проверка понятности объяснений
   - Тестирование полноты информации
   - Валидация последовательности

### Стратегия сопровождения

- **Синхронизация с кодом**: автоматическое обновление при изменениях
- **Регулярный аудит**: ежемесячная проверка актуальности
- **Обратная связь**: система сбора замечаний
- **Версионирование**: отслеживание изменений

### Интеграция с процессом разработки

- **Code review**: обязательное обновление документации при изменении API
- **Testing**: проверка примеров кода при сборке
- **Release process**: обновление документации в релизных заметках
- **Continuous improvement**: постоянное улучшение качества документации