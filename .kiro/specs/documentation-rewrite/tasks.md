# План реализации переписывания документации

- [x] 1. Обновить архитектурную документацию





  - Переписать документацию с учетом модульной архитектуры
  - Обновить описание взаимодействия компонентов
  - Документировать современные Chrome API паттерны
  - _Требования: 1.1, 1.2, 1.3, 1.4_

- [x] 1.1 Переписать обзор архитектуры расширения


  - Обновить docs/architecture/extension-overview.md с текущей структурой
  - Документировать Manifest V3 конфигурацию и permissions
  - Описать роль popup.html/popup.js в пользовательском интерфейсе
  - Объяснить content.js как точку входа и координатор модулей
  - Документировать background service worker и его функции
  - _Требования: 1.1, 1.4_



- [x] 1.2 Создать документацию модульной системы
  - Создать docs/architecture/module-system.md для модульной архитектуры
  - Документировать структуру папки modules/ и назначение каждого модуля
  - Описать систему экспорта в глобальное пространство window
  - Объяснить порядок загрузки модулей через manifest.json
  - Документировать зависимости между модулями и их разрешение
  - _Требования: 1.2_

- [x] 1.3 Обновить документацию взаимодействия компонентов
  - Переписать docs/architecture/component-interaction.md с актуальными паттернами
  - Документировать коммуникацию popup ↔ content script через chrome.runtime.sendMessage
  - Описать обработку сообщений в main.js через setupMessageListener
  - Объяснить синхронизацию состояния через Chrome Storage API
  - Добавить обработку ошибок и восстановление соединения
  - _Требования: 1.2, 4.3_

- [x] 1.4 Обновить справочник Chrome APIs
  - Переписать docs/architecture/chrome-apis.md с актуальными примерами
  - Документировать chrome.storage.local с текущей схемой данных
  - Обновить примеры chrome.tabs для управления вкладками
  - Добавить chrome.runtime для обмена сообщениями
  - Документировать chrome.action для управления иконкой расширения
  - _Требования: 1.3_

- [x] 2. Обновить документацию интеграции со Столото






  - Проверить актуальность всех селекторов на реальном сайте
  - Обновить пользовательские сценарии
  - Документировать систему авторизации и работу с балансом
  - _Требования: 2.1, 2.2, 2.3, 2.4, 2.5_

- [x] 2.1 Проверить и обновить структуру DOM


  - **ВАЖНО: Использовать playwright MCP для изучения неавторизованного состояния сайта**
  - Изучить текущую страницу https://www.stoloto.ru/ruslotto/game?viewType=favorite через playwright MCP
  - Обновить docs/stoloto-integration/dom-structure.md с актуальной структурой
  - Проверить структуру билета и расположение чисел (6 строк по 9 чисел)
  - Документировать элементы управления выбором чисел
  - Обновить описание кнопок навигации и пагинации
  - Сравнить с кодом расширения и выявить расхождения
  - _Требования: 2.1, 2.5_

- [x] 2.2 Обновить справочник селекторов


  - **ВАЖНО: Использовать playwright MCP для неавторизованного состояния, browser MCP для авторизованного**
  - **При проблемах с browser MCP - остановиться и попросить исправить соединение**
  - Проверить все селекторы из кода на реальном сайте через MCP инструменты
  - Обновить docs/stoloto-integration/selectors-reference.md с актуальными селекторами
  - Проверить селекторы чисел: [data-test-id="number"], [data-test-id="selected-number"]
  - Обновить селекторы билетов: button[class*="Ticket_btn"], [data-test-id="ticket-number"]
  - Проверить кнопки управления: "Показать билеты", "Другие билеты", "Очистить"
  - Обновить селекторы авторизации и баланса
  - _Требования: 2.1, 2.2, 2.3, 2.4_


- [x] 2.3 Обновить пользовательские сценарии

  - **ВАЖНО: Использовать playwright MCP для неавторизованных сценариев, browser MCP для авторизованных**
  - **При проблемах с browser MCP - остановиться и попросить исправить соединение**
  - Переписать docs/stoloto-integration/user-flows.md с актуальными сценариями
  - Документировать процесс выбора чисел и генерации билетов (playwright MCP)
  - Обновить описание навигации между страницами билетов (playwright MCP)
  - Добавить сценарий автоматической покупки билетов (browser MCP - требует авторизации)
  - Документировать проверку авторизации и баланса пользователя (browser MCP)
  - _Требования: 2.1, 2.2, 2.3, 2.4, 6.1, 6.2, 6.3, 6.4, 6.5_


- [x] 2.4 Создать документацию системы авторизации

  - **ВАЖНО: Использовать browser MCP для проверки авторизованного состояния**
  - **При проблемах с browser MCP - остановиться и попросить исправить соединение**
  - Создать docs/stoloto-integration/authentication.md для системы авторизации
  - Документировать функцию isUserLoggedIn() и её логику
  - Описать получение баланса через getUserBalance() из ссылки на кошелек (проверить через browser MCP)
  - Объяснить кэширование статуса авторизации в Chrome Storage
  - Документировать проверку достаточности средств hasEnoughFunds()
  - Проверить селекторы авторизации на реальном сайте через browser MCP
  - _Требования: 2.3, 2.4_

- [ ] 3. Обновить документацию алгоритмов
  - Переписать документацию режимов поиска с актуальным кодом
  - Добавить документацию автоматической покупки
  - Обновить стратегии защиты от блокировки
  - _Требования: 3.1, 3.2, 3.3, 3.4, 3.5_

- [ ] 3.1 Переписать документацию режимов поиска
  - Обновить docs/algorithms/search-modes.md с актуальной логикой
  - Документировать режим "anywhere" с примерами из analyzeTicket()
  - Обновить режим "half" с логикой разделения на строки 1-3 и 4-6
  - Документировать режим "row" с поиском в одной строке
  - Добавить примеры группировки чисел по строкам (по 9 чисел)
  - _Требования: 3.1, 3.4_

- [ ] 3.2 Создать документацию анализа билетов
  - Создать docs/algorithms/ticket-analysis.md для анализа билетов
  - Документировать функцию analyzeTicket() и её логику
  - Описать парсинг чисел из DOM элементов билета
  - Объяснить фильтрацию исключаемых чисел
  - Добавить валидацию структуры билета (6 строк)
  - _Требования: 3.2, 3.3_

- [ ] 3.3 Создать документацию автоматической покупки
  - Создать docs/algorithms/purchase-automation.md для режима покупки
  - Документировать логику режима покупки в findSuitableTicket()
  - Описать проверку кнопок оплаты через checkPaymentButtons()
  - Объяснить процесс нажатия на кнопку "Оплатить кошельком"
  - Документировать подсчет купленных билетов и управление лимитами
  - Добавить логику перезагрузки страницы для продолжения покупки
  - _Требования: 3.1, 3.4, 3.5_

- [ ] 3.4 Обновить стратегии защиты от блокировки
  - Обновить docs/algorithms/anti-blocking.md с актуальными стратегиями
  - Документировать случайные задержки между действиями (250-1000мс)
  - Описать имитацию человеческого поведения при кликах
  - Обновить обработку таймаутов и сетевых ошибок
  - Документировать восстановление после перезагрузки страницы
  - _Требования: 3.5_

- [ ] 4. Обновить документацию управления состоянием
  - Документировать глобальное состояние window.stolotoState
  - Обновить схему Chrome Storage с актуальными данными
  - Описать жизненный цикл состояний поиска и покупки
  - _Требования: 4.1, 4.2, 4.3, 4.4, 4.5_

- [ ] 4.1 Создать документацию глобального состояния
  - Создать docs/state-management/global-state.md для глобального состояния
  - Документировать объект window.stolotoState и его структуру
  - Описать состояние поиска: isSearching, searchMode, ticketsChecked
  - Документировать состояние покупки: isPurchaseMode, totalTicketsToBuy, ticketsPurchased
  - Объяснить временные метки и счетчики
  - _Требования: 4.1_

- [ ] 4.2 Обновить схему Chrome Storage
  - Обновить docs/state-management/storage-schema.md с актуальной схемой
  - Документировать структуру purchaseState для режима покупки
  - Обновить объект lastSearch для сохранения параметров
  - Описать кэш authStatus для статуса авторизации
  - Добавить примеры сохранения и загрузки данных
  - _Требования: 4.1, 4.5_

- [ ] 4.3 Обновить жизненный цикл состояний
  - Обновить docs/state-management/lifecycle.md с актуальными состояниями
  - Документировать инициализацию состояния при загрузке страницы
  - Описать переходы между состояниями поиска и покупки
  - Объяснить сохранение состояния перед перезагрузкой
  - Документировать восстановление состояния после перезагрузки
  - _Требования: 4.2, 4.4_

- [ ] 4.4 Обновить синхронизацию данных
  - Обновить docs/state-management/synchronization.md с актуальными механизмами
  - Документировать обмен сообщениями между popup и content script
  - Описать обновление UI в реальном времени
  - Объяснить сохранение промежуточных результатов
  - Добавить разрешение конфликтов данных
  - _Требования: 4.3, 4.4_

- [ ] 5. Создать обновленную справочную документацию
  - Создать справочник модулей с их функциями
  - Обновить справочник функций с актуальными сигнатурами
  - Документировать современные паттерны разработки
  - _Требования: 5.1, 5.2, 5.3, 5.4, 5.5_

- [ ] 5.1 Создать справочник модулей
  - Создать docs/development/modules-reference.md для справочника модулей
  - Документировать main.js: координация и основная логика
  - Описать state.js: управление состоянием
  - Документировать auth.js: авторизация и баланс
  - Описать search.js: поиск и анализ билетов
  - Документировать ui.js: пользовательский интерфейс
  - Описать payment.js: обработка платежей
  - Документировать utils.js: вспомогательные функции
  - _Требования: 5.1_

- [ ] 5.2 Обновить справочник функций
  - Обновить docs/development/functions-reference.md с актуальными функциями
  - Документировать clickNumbers(): основная функция поиска
  - Обновить analyzeTicket(): анализ билета
  - Документировать isUserLoggedIn(): проверка авторизации
  - Описать getUserBalance(): получение баланса
  - Документировать savePurchaseState()/loadPurchaseState(): управление состоянием
  - Добавить updateStatusBlock(): обновление UI
  - _Требования: 5.1, 5.2_

- [ ] 5.3 Обновить паттерны разработки
  - Обновить docs/development/patterns.md с современными паттернами
  - Документировать модульную архитектуру и экспорт в window
  - Описать асинхронные паттерны с async/await
  - Обновить обработку ошибок и graceful degradation
  - Документировать работу с DOM и селекторами
  - Добавить паттерны обмена сообщениями
  - _Требования: 5.2, 5.5_

- [ ] 5.4 Обновить руководство по отладке
  - Обновить docs/development/debugging.md с актуальными методами
  - Документировать использование console.log для трассировки
  - Описать отладку через Chrome DevTools для расширений
  - Обновить тестирование на реальном сайте Столото
  - Добавить диагностику проблем авторизации
  - Документировать отладку состояния и синхронизации
  - _Требования: 5.3, 5.4_

- [ ] 6. Обновить главную документацию и навигацию
  - Переписать главную страницу документации
  - Обновить навигацию между разделами
  - Создать руководство по быстрому старту
  - _Требования: 7.1, 7.2, 7.3, 7.4, 7.5_

- [ ] 6.1 Переписать главную страницу документации
  - Обновить docs/README.md как главную точку входа
  - Создать обзор текущей архитектуры расширения
  - Добавить быстрые ссылки на ключевые разделы
  - Включить руководство по навигации в документации
  - Добавить информацию о последних обновлениях
  - _Требования: 7.1, 7.2, 7.3, 7.4, 7.5_

- [ ] 6.2 Обновить перекрестные ссылки
  - Проверить и обновить все внутренние ссылки в документации
  - Добавить перекрестные ссылки между связанными разделами
  - Создать индекс ключевых терминов и понятий
  - Обновить ссылки на примеры кода в соответствующих файлах
  - Добавить ссылки на внешние ресурсы (Chrome API документация)
  - _Требования: 7.1, 7.2, 7.3, 7.4, 7.5_

- [ ] 7. Валидировать и протестировать обновленную документацию
  - Проверить соответствие всех примеров кода актуальной реализации
  - Протестировать все селекторы на реальном сайте
  - Валидировать полноту покрытия всех функций
  - _Требования: 1.1, 1.2, 1.3, 1.4, 2.1, 2.2, 2.3, 2.4, 2.5, 3.1, 3.2, 3.3, 3.4, 3.5, 4.1, 4.2, 4.3, 4.4, 4.5, 5.1, 5.2, 5.3, 5.4, 5.5, 6.1, 6.2, 6.3, 6.4, 6.5, 7.1, 7.2, 7.3, 7.4, 7.5_

- [ ] 7.1 Проверить соответствие кода и документации
  - Сравнить все примеры кода в документации с актуальными файлами
  - Проверить актуальность сигнатур функций
  - Валидировать описания алгоритмов с их реализацией
  - Убедиться в соответствии схемы данных реальному коду
  - Проверить актуальность селекторов и их использования
  - _Требования: 1.1, 1.2, 1.3, 1.4, 3.1, 3.2, 3.3, 3.4, 3.5, 5.1, 5.2_

- [ ] 7.2 Протестировать селекторы на реальном сайте
  - **ВАЖНО: Использовать playwright MCP для неавторизованных селекторов, browser MCP для авторизованных**
  - **При проблемах с browser MCP - остановиться и попросить исправить соединение**
  - Проверить все CSS селекторы на странице https://www.stoloto.ru/ruslotto/game?viewType=favorite
  - Убедиться в работоспособности селекторов чисел и билетов (playwright MCP)
  - Проверить селекторы авторизации и баланса (browser MCP - требует авторизации)
  - Валидировать селекторы кнопок управления и навигации (playwright MCP)
  - Протестировать селекторы оплаты и покупки (browser MCP - требует авторизации)
  - Документировать различия между авторизованным и неавторизованным состояниями
  - _Требования: 2.1, 2.2, 2.3, 2.4, 2.5_

- [ ] 7.3 Валидировать полноту документации
  - Проверить покрытие всех модулей и их функций
  - Убедиться в наличии примеров для всех ключевых сценариев
  - Проверить полноту описания всех состояний и переходов
  - Валидировать покрытие всех пользовательских сценариев
  - Убедиться в актуальности всех справочных материалов
  - _Требования: 4.1, 4.2, 4.3, 4.4, 4.5, 5.1, 5.2, 5.3, 5.4, 5.5, 6.1, 6.2, 6.3, 6.4, 6.5, 7.1, 7.2, 7.3, 7.4, 7.5_
## Техниче
ские инструкции по использованию MCP

### Playwright MCP
- **Назначение**: Проверка сайта в неавторизованном состоянии
- **Использование**: Для изучения общей структуры DOM, селекторов чисел, билетов, кнопок навигации
- **Команды**: 
  - `mcp_playwright_browser_navigate` - переход на страницу
  - `mcp_playwright_browser_snapshot` - получение структуры страницы
  - `mcp_playwright_browser_click` - тестирование кликов по элементам

### Browser MCP  
- **Назначение**: Проверка сайта в авторизованном состоянии
- **Использование**: Для проверки селекторов баланса, кнопок оплаты, авторизованных функций
- **Важно**: При проблемах с доступом к browser MCP - остановиться и попросить исправить соединение
- **Команды**:
  - `mcp_browsermcp_browser_navigate` - переход на страницу
  - `mcp_browsermcp_browser_snapshot` - получение структуры авторизованной страницы
  - `mcp_browsermcp_browser_click` - тестирование авторизованных функций

### Протокол обработки ошибок MCP
1. При ошибке подключения к playwright MCP - попробовать повторно
2. При ошибке подключения к browser MCP - **ОСТАНОВИТЬСЯ** и попросить пользователя исправить соединение
3. При получении неожиданной структуры DOM - сравнить с кодом расширения и документировать расхождения
4. При изменении селекторов - обновить документацию и отметить изменения